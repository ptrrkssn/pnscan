# Makefile for pkgs

PACKAGE =	@PACKAGE_TARNAME@
VERSION =	@PACKAGE_VERSION@
PORTSDIR =	/usr/ports
PORTSNAME =	sysutils/$(PACKAGE)
BREWDIR =	/usr/local/Homebrew/Library/Taps/homebrew/homebrew-core/Formula
INSTALL =	@INSTALL@
@SET_MAKE@

all:
	@echo "Valid targets: 'port' (FreeBSD) or 'brew' (MacOS Homebrew)"
	@exit 1

#

port:	Makefile.port pkg-descr pkg-plist
	mkdir -p "$(PORTSDIR)/$(PORTSNAME)"
	cp Makefile.port "$(PORTSDIR)/$(PORTSNAME)/Makefile"
	cp pkg-descr pkg-plist "$(PORTSDIR)/$(PORTSNAME)"
	(cd "$(PORTSDIR)/$(PORTSNAME)" && make distclean && make makesum && portlint -AC && port test "$(PORTSDIR)/$(PORTSNAME)")

port-install: port
	(cd "$(PORTSDIR)/$(PORTSNAME)" && make install)

#

brew: brew-install-formulae brew-install-dist

brew-install: brew
	  (brew install $(PACKAGE) || brew upgrade $(PACKAGE) || brew reinstall $(PACKAGE))

brew-install-formulae: $(PACKAGE).rb
	$(INSTALL) -m 0644 $(PACKAGE).rb $(BREWDIR)

# Alternative way to create the formulae
brew-create-formulae:
	brew create https://github.com/ptrrkssn/$(PACKAGE)/archive/v$(VERSION).tar.gz
	brew edit $(PACKAGE)

brew-install-dist:
	(cd .. && $(MAKE) dist && cp "$(PACKAGE)-$(VERSION).tar.gz" "`brew --cache $(PACKAGE)`")


# Clean targets
maintainer-clean:	distclean

distclean:		clean
	rm -fr Makefile.port

clean mostlyclean:
	-rm -f *~ \#*
